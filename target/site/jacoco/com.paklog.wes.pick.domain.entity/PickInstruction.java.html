<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>PickInstruction.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">pick-execution-service</a> &gt; <a href="index.source.html" class="el_package">com.paklog.wes.pick.domain.entity</a> &gt; <span class="el_source">PickInstruction.java</span></div><h1>PickInstruction.java</h1><pre class="source lang-java linenums">package com.paklog.wes.pick.domain.entity;

import com.paklog.domain.valueobject.Priority;
import com.paklog.wes.pick.domain.valueobject.InstructionStatus;
import com.paklog.wes.pick.domain.valueobject.Location;

import java.time.LocalDateTime;
import java.util.ArrayList;
import java.util.List;
import java.util.Objects;

/**
 * Pick instruction entity
 * Represents a single item to be picked in a session
 */
public class PickInstruction {

    private String instructionId;
    private String itemSku;
    private String itemDescription;
    private int expectedQuantity;
    private int pickedQuantity;
    private Location location;
    private String orderId;
    private InstructionStatus status;
    private int sequenceNumber;
    private Priority priority;
    private double weight;
    private String uom;
    private List&lt;String&gt; specialHandling;
    private String shortPickReason;
    private LocalDateTime pickedAt;

    // For MongoDB/persistence
<span class="nc" id="L35">    public PickInstruction() {</span>
<span class="nc" id="L36">        this.specialHandling = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L37">    }</span>

    public PickInstruction(
            String instructionId,
            String itemSku,
            String itemDescription,
            int expectedQuantity,
            Location location,
            String orderId,
            Priority priority
<span class="fc" id="L47">    ) {</span>
<span class="fc" id="L48">        this.instructionId = Objects.requireNonNull(instructionId, &quot;Instruction ID cannot be null&quot;);</span>
<span class="fc" id="L49">        this.itemSku = Objects.requireNonNull(itemSku, &quot;Item SKU cannot be null&quot;);</span>
<span class="fc" id="L50">        this.itemDescription = itemDescription;</span>
<span class="fc" id="L51">        this.expectedQuantity = expectedQuantity;</span>
<span class="fc" id="L52">        this.pickedQuantity = 0;</span>
<span class="fc" id="L53">        this.location = Objects.requireNonNull(location, &quot;Location cannot be null&quot;);</span>
<span class="fc" id="L54">        this.orderId = orderId;</span>
<span class="fc" id="L55">        this.status = InstructionStatus.PENDING;</span>
<span class="pc bpc" id="L56" title="1 of 2 branches missed.">        this.priority = priority != null ? priority : Priority.NORMAL;</span>
<span class="fc" id="L57">        this.specialHandling = new ArrayList&lt;&gt;();</span>

<span class="pc bpc" id="L59" title="1 of 2 branches missed.">        if (expectedQuantity &lt;= 0) {</span>
<span class="nc" id="L60">            throw new IllegalArgumentException(&quot;Expected quantity must be positive&quot;);</span>
        }
<span class="fc" id="L62">    }</span>

    /**
     * Start picking this instruction
     */
    public void start() {
<span class="fc" id="L68">        ensureStatus(InstructionStatus.PENDING);</span>
<span class="fc" id="L69">        this.status = InstructionStatus.IN_PROGRESS;</span>
<span class="fc" id="L70">    }</span>

    /**
     * Confirm full pick
     */
    public void confirmPick(int quantity) {
<span class="fc" id="L76">        ensureStatus(InstructionStatus.IN_PROGRESS);</span>

<span class="fc bfc" id="L78" title="All 2 branches covered.">        if (quantity &lt;= 0) {</span>
<span class="fc" id="L79">            throw new IllegalArgumentException(&quot;Picked quantity must be positive&quot;);</span>
        }

<span class="fc bfc" id="L82" title="All 2 branches covered.">        if (quantity &gt; expectedQuantity) {</span>
<span class="fc" id="L83">            throw new IllegalArgumentException(</span>
<span class="fc" id="L84">                    String.format(&quot;Picked quantity (%d) exceeds expected quantity (%d)&quot;,</span>
<span class="fc" id="L85">                            quantity, expectedQuantity)</span>
            );
        }

<span class="fc" id="L89">        this.pickedQuantity = quantity;</span>
<span class="fc" id="L90">        this.pickedAt = LocalDateTime.now();</span>

<span class="fc bfc" id="L92" title="All 2 branches covered.">        if (quantity == expectedQuantity) {</span>
<span class="fc" id="L93">            this.status = InstructionStatus.PICKED;</span>
        } else {
<span class="fc" id="L95">            this.status = InstructionStatus.SHORT_PICKED;</span>
        }
<span class="fc" id="L97">    }</span>

    /**
     * Handle short pick scenario
     */
    public void shortPick(int actualQuantity, String reason) {
<span class="fc" id="L103">        ensureStatus(InstructionStatus.IN_PROGRESS);</span>

<span class="fc bfc" id="L105" title="All 2 branches covered.">        if (actualQuantity &lt; 0) {</span>
<span class="fc" id="L106">            throw new IllegalArgumentException(&quot;Actual quantity cannot be negative&quot;);</span>
        }

<span class="fc bfc" id="L109" title="All 2 branches covered.">        if (actualQuantity &gt;= expectedQuantity) {</span>
<span class="fc" id="L110">            throw new IllegalArgumentException(&quot;Use confirmPick for full quantity picks&quot;);</span>
        }

<span class="fc" id="L113">        this.pickedQuantity = actualQuantity;</span>
<span class="fc" id="L114">        this.shortPickReason = reason;</span>
<span class="fc" id="L115">        this.status = InstructionStatus.SHORT_PICKED;</span>
<span class="fc" id="L116">        this.pickedAt = LocalDateTime.now();</span>
<span class="fc" id="L117">    }</span>

    /**
     * Skip this instruction
     */
    public void skip(String reason) {
<span class="fc" id="L123">        ensureStatus(InstructionStatus.PENDING, InstructionStatus.IN_PROGRESS);</span>
<span class="fc" id="L124">        this.status = InstructionStatus.SKIPPED;</span>
<span class="fc" id="L125">        this.shortPickReason = reason;</span>
<span class="fc" id="L126">    }</span>

    /**
     * Cancel instruction
     */
    public void cancel() {
<span class="fc bfc" id="L132" title="All 2 branches covered.">        if (status.isComplete()) {</span>
<span class="fc" id="L133">            throw new IllegalStateException(&quot;Cannot cancel completed instruction&quot;);</span>
        }
<span class="fc" id="L135">        this.status = InstructionStatus.CANCELLED;</span>
<span class="fc" id="L136">    }</span>

    /**
     * Set sequence number for path optimization
     */
    public void setSequenceNumber(int sequenceNumber) {
<span class="fc bfc" id="L142" title="All 2 branches covered.">        if (sequenceNumber &lt; 0) {</span>
<span class="fc" id="L143">            throw new IllegalArgumentException(&quot;Sequence number cannot be negative&quot;);</span>
        }
<span class="fc" id="L145">        this.sequenceNumber = sequenceNumber;</span>
<span class="fc" id="L146">    }</span>

    /**
     * Check if instruction is complete
     */
    public boolean isComplete() {
<span class="fc" id="L152">        return status.isComplete();</span>
    }

    /**
     * Check if this was a short pick
     */
    public boolean isShortPick() {
<span class="fc bfc" id="L159" title="All 2 branches covered.">        return status == InstructionStatus.SHORT_PICKED;</span>
    }

    /**
     * Get shortage quantity
     */
    public int getShortageQuantity() {
<span class="pc bpc" id="L166" title="1 of 2 branches missed.">        if (status != InstructionStatus.SHORT_PICKED) {</span>
<span class="nc" id="L167">            return 0;</span>
        }
<span class="fc" id="L169">        return expectedQuantity - pickedQuantity;</span>
    }

    /**
     * Calculate pick accuracy for this instruction
     */
    public double getAccuracy() {
<span class="pc bpc" id="L176" title="1 of 2 branches missed.">        if (expectedQuantity == 0) {</span>
<span class="nc" id="L177">            return 100.0;</span>
        }
<span class="fc" id="L179">        return (pickedQuantity / (double) expectedQuantity) * 100.0;</span>
    }

    /**
     * Add special handling requirement
     */
    public void addSpecialHandling(String handling) {
<span class="pc bpc" id="L186" title="2 of 4 branches missed.">        if (handling != null &amp;&amp; !handling.isBlank()) {</span>
<span class="fc" id="L187">            this.specialHandling.add(handling);</span>
        }
<span class="fc" id="L189">    }</span>

    /**
     * Check if instruction requires special handling
     */
    public boolean hasSpecialHandling() {
<span class="fc bfc" id="L195" title="All 2 branches covered.">        return !specialHandling.isEmpty();</span>
    }

    private void ensureStatus(InstructionStatus... allowedStatuses) {
<span class="pc bpc" id="L199" title="1 of 2 branches missed.">        for (InstructionStatus allowed : allowedStatuses) {</span>
<span class="pc bpc" id="L200" title="1 of 2 branches missed.">            if (this.status == allowed) {</span>
<span class="fc" id="L201">                return;</span>
            }
        }
<span class="nc" id="L204">        throw new IllegalStateException(</span>
<span class="nc" id="L205">                String.format(&quot;Invalid status transition. Current: %s, Expected: %s&quot;,</span>
<span class="nc" id="L206">                        this.status, List.of(allowedStatuses))</span>
        );
    }

    // Getters and setters

    public String getInstructionId() {
<span class="fc" id="L213">        return instructionId;</span>
    }

    public void setInstructionId(String instructionId) {
<span class="nc" id="L217">        this.instructionId = instructionId;</span>
<span class="nc" id="L218">    }</span>

    public String getItemSku() {
<span class="fc" id="L221">        return itemSku;</span>
    }

    public void setItemSku(String itemSku) {
<span class="nc" id="L225">        this.itemSku = itemSku;</span>
<span class="nc" id="L226">    }</span>

    public String getItemDescription() {
<span class="fc" id="L229">        return itemDescription;</span>
    }

    public void setItemDescription(String itemDescription) {
<span class="nc" id="L233">        this.itemDescription = itemDescription;</span>
<span class="nc" id="L234">    }</span>

    public int getExpectedQuantity() {
<span class="fc" id="L237">        return expectedQuantity;</span>
    }

    public void setExpectedQuantity(int expectedQuantity) {
<span class="nc" id="L241">        this.expectedQuantity = expectedQuantity;</span>
<span class="nc" id="L242">    }</span>

    public int getPickedQuantity() {
<span class="fc" id="L245">        return pickedQuantity;</span>
    }

    public void setPickedQuantity(int pickedQuantity) {
<span class="fc" id="L249">        this.pickedQuantity = pickedQuantity;</span>
<span class="fc" id="L250">    }</span>

    public Location getLocation() {
<span class="fc" id="L253">        return location;</span>
    }

    public void setLocation(Location location) {
<span class="nc" id="L257">        this.location = location;</span>
<span class="nc" id="L258">    }</span>

    public String getOrderId() {
<span class="fc" id="L261">        return orderId;</span>
    }

    public void setOrderId(String orderId) {
<span class="nc" id="L265">        this.orderId = orderId;</span>
<span class="nc" id="L266">    }</span>

    public InstructionStatus getStatus() {
<span class="fc" id="L269">        return status;</span>
    }

    public void setStatus(InstructionStatus status) {
<span class="fc" id="L273">        this.status = status;</span>
<span class="fc" id="L274">    }</span>

    public int getSequenceNumber() {
<span class="fc" id="L277">        return sequenceNumber;</span>
    }

    public Priority getPriority() {
<span class="fc" id="L281">        return priority;</span>
    }

    public void setPriority(Priority priority) {
<span class="nc" id="L285">        this.priority = priority;</span>
<span class="nc" id="L286">    }</span>

    public double getWeight() {
<span class="nc" id="L289">        return weight;</span>
    }

    public void setWeight(double weight) {
<span class="nc" id="L293">        this.weight = weight;</span>
<span class="nc" id="L294">    }</span>

    public String getUom() {
<span class="nc" id="L297">        return uom;</span>
    }

    public void setUom(String uom) {
<span class="nc" id="L301">        this.uom = uom;</span>
<span class="nc" id="L302">    }</span>

    public List&lt;String&gt; getSpecialHandling() {
<span class="fc" id="L305">        return specialHandling;</span>
    }

    public void setSpecialHandling(List&lt;String&gt; specialHandling) {
<span class="nc" id="L309">        this.specialHandling = specialHandling;</span>
<span class="nc" id="L310">    }</span>

    public String getShortPickReason() {
<span class="fc" id="L313">        return shortPickReason;</span>
    }

    public void setShortPickReason(String shortPickReason) {
<span class="nc" id="L317">        this.shortPickReason = shortPickReason;</span>
<span class="nc" id="L318">    }</span>

    public LocalDateTime getPickedAt() {
<span class="fc" id="L321">        return pickedAt;</span>
    }

    public void setPickedAt(LocalDateTime pickedAt) {
<span class="nc" id="L325">        this.pickedAt = pickedAt;</span>
<span class="nc" id="L326">    }</span>

    @Override
    public boolean equals(Object o) {
<span class="fc bfc" id="L330" title="All 2 branches covered.">        if (this == o) return true;</span>
<span class="pc bpc" id="L331" title="2 of 4 branches missed.">        if (o == null || getClass() != o.getClass()) return false;</span>
<span class="fc" id="L332">        PickInstruction that = (PickInstruction) o;</span>
<span class="fc" id="L333">        return Objects.equals(instructionId, that.instructionId);</span>
    }

    @Override
    public int hashCode() {
<span class="nc" id="L338">        return Objects.hash(instructionId);</span>
    }

    @Override
    public String toString() {
<span class="nc" id="L343">        return &quot;PickInstruction{&quot; +</span>
                &quot;instructionId='&quot; + instructionId + '\'' +
                &quot;, itemSku='&quot; + itemSku + '\'' +
                &quot;, expectedQuantity=&quot; + expectedQuantity +
                &quot;, pickedQuantity=&quot; + pickedQuantity +
                &quot;, location=&quot; + location +
                &quot;, status=&quot; + status +
                '}';
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.10.202304240956</span></div></body></html>